# AWS SQS + SNS 와 kafka의 차이점?

## 1. 개요

서비스 하고 있는 시스템에서 메시징 시스템으로 [AWS SQS와 SNS를 조합](https://github.com/G0RANI/eye-opener/blob/main/small-talk/AWS%20SQS%20%2B%20SNS%20%EB%A5%BC%20%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90.md)하여 쓰고 있다. 

해당 내용을 적용하기 전에 다른 메시징 서비스로 여러 가지를 알아 보았는데 kafka도 그중 하나였다.

지금의 내용을 선택한 이유는 첫번째로 둘다 처음 도입하는데 러닝커브가 일반적으로 kafka가 높다고 들었다.

그래서 kafka를 관리 해줄 수 있는 Amazon Msk를 고민에 두게 되었다.

그러고 보니 상대적인 비용을 생각해보았을때 AWS SQS + SNS가 현저하게 낮았기 때문에 선택하게 되었다.

하지만 kafka도 도입하고 싶었던 친구중에 하나기 때문에 비용 문제를 빼고 어떠한 차이점이 있고 어느 상황, 선택의 기준 등에 대해 알아보았다.



## 2. Kafka 란?

[AWS SQS와 SNS의 조합](https://github.com/G0RANI/eye-opener/blob/main/small-talk/AWS%20SQS%20%2B%20SNS%20%EB%A5%BC%20%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90.md) 에 대해서는 해당 링크를 보면 될듯하다.

Kafka의 이름은 작가 프란츠 카프카(Franz Kafka)의 성을 따서 지어졌다고 한다.

그의 작품은 현실과 비현실의 경계를 넘나드는 복잡한 이야기와 캐릭터를 다루는 것으로 유명하다.

Kafka 프로젝트는 이 작가의 이름을 사용하여 복잡성과 확장성을 갖춘 데이터 스트리밍 플랫폼을 나타내고자 했다 한다. 

Kafka의 설계 목표 중 하나는 대량의 데이터를 처리하면서도 안정성과 내결함성을 제공하는 것이었는데, 

이와 같은 목표는 카프카의 작품에서 나타나는 복잡성과 혼돈된 세계에 대한 연관성을 가지고 있다고 볼 수 있다.

Kafka는 아파치 소프트웨어 재단(Apache Software Foundation)에서 개발된 분산 스트리밍 플랫폼이다. 

대용량의 실시간 데이터를 안정적으로 처리하고 저장하며, 실시간 데이터 피드를 구축하는 데 사용된다. 

Kafka는 큐와 로그와 같은 메시징 시스템과 데이터 스트리밍 플랫폼의 기능을 결합한 것으로 생각할 수 있다.

#### 주요 특징

1. 분산 아키텍처: Kafka는 여러 개의 서버 노드로 구성된 분산 시스템이다. 이를 통해 데이터의 스케일 아웃과 고가용성을 지원하며, 대량의 데이터 처리를 위한 수평 확장이 가능하다.
2. 토픽 기반 메시징: Kafka는 토픽(Topic)이라는 개념을 사용하여 데이터를 분류하고 저장한다. 프로듀서(Producer)는 특정 토픽으로 데이터를 보내고, 컨슈머(Consumer)는 해당 토픽에서 데이터를 읽어온다. 이를 통해 여러 컨슈머가 동일한 데이터를 동시에 소비할 수 있다.
3. 영속성과 내고장성: Kafka는 디스크에 데이터를 지속적으로 저장하여 데이터의 내구성을 보장한다. 또한 복제와 파티션 분산 등의 메커니즘을 사용하여 내고장성을 갖추고 있다.
4. 높은 처리량과 지연 시간: Kafka는 대량의 실시간 데이터를 처리할 수 있는 높은 처리량과 낮은 지연 시간을 제공한다. 이는 데이터를 메모리에 유지하고 효율적인 디스크 I/O를 수행함으로써 가능하다.

Kafka는 데이터 파이프라인, 이벤트 스트리밍, 웹 로그 분석, 메시지 큐 등 다양한 사용 사례에서 활용된다. 

대규모 데이터 처리와 실시간 데이터 피드를 필요로하는 애플리케이션에 많이 사용되며, 확장성과 내결함성을 중요시하는 시스템에 적합한 선택지다.

Kafka를 이해 하기 위해서는 기본적으로 알아둬야 하는 용어들이 있다.

#### 용어

1. 토픽(Topic): 데이터 스트림을 분류하는 논리적인 이름이다. 토픽은 하나 이상의 파티션으로 구성됩니다. 예를 들어, "주문", "로그", "이벤트" 등의 토픽을 생성할 수 있다.
2. 파티션(Partition): 토픽을 분할한 물리적인 단위다. 각 파티션은 순서가 있는 데이터 스트림을 나타내며, 디스크에 영구적으로 저장됩니다. 파티션은 병렬 처리와 확장성을 지원하고, Kafka 클러스터의 여러 브로커에 분산될 수 있다.
3. 프로듀서(Producer): 데이터를 Kafka 토픽에 보내는 애플리케이션이다. 프로듀서는 데이터를 생성하고 특정 토픽으로 전송하여 Kafka에 쓰기 작업을 수행한다.
4. 컨슈머(Consumer): Kafka 토픽에서 데이터를 읽어오는 애플리케이션이다. 컨슈머는 토픽에서 데이터를 읽어와서 처리하거나 저장하는 역할을 한다.
5. 컨슈머 그룹(Consumer Group): 동일한 토픽에서 데이터를 읽어오는 하나 이상의 컨슈머들의 논리적인 그룹이다. 컨슈머 그룹은 토픽의 각 파티션을 분산하여 처리하고, 병렬 처리와 확장성을 제공한다. 각 파티션은 오직 하나의 컨슈머 그룹 내의 컨슈머에 의해 소비된다.
6. 브로커(Broker): Kafka 클러스터의 각 서버를 의미한다. 각 브로커는 Kafka 토픽의 파티션을 저장하고 관리하며, 프로듀서와 컨슈머 간의 데이터 스트림을 중재한다.
7. 리더(Leader)와 팔로워(Follower): 각 파티션은 리더와 팔로워로 구성된다. 리더는 해당 파티션의 모든 읽기 및 쓰기 작업을 처리하는 역할을 담당하며, 팔로워는 리더의 복제본으로 데이터를 동기화하여 고가용성과 내결함성을 제공한다.

Kafka를 사용할 때 이러한 개념들을 활용하여 토픽과 파티션을 설정하고, 프로듀서와 컨슈머를 구성하며, 컨슈머 그룹을 관리한다.



## 3. 두 서비스의 장단점

두 서비스의 장점과 단점에 대해 알아 보았다.

AWS SNS + SQS:

- 장점:
  - 간단하게 설정하고 사용할 수 있으며, AWS에서 관리되므로 관리 오버헤드가 적습니다.
  - 확장성이 뛰어나며, 대규모 메시지 처리에 적합합니다.
  - 서버리스 아키텍처에 적합하며, 다른 AWS 서비스와의 통합이 용이합니다.
- 단점:
  - SNS는 푸시 기반이므로 메시지의 순서를 보장하지 않습니다. SQS를 사용하면 순서 보장이 가능하지만 추가적인 구성이 필요합니다.
  - 고가용성 및 확장성을 위해 AWS에 종속되어 있습니다.
  - 비용이 다른 오픈 소스 대안에 비해 상대적으로 높을 수 있습니다.

Kafka:

- 장점:
  - 뛰어난 처리량과 확장성을 제공하여 대용량 데이터 처리에 적합합니다.
  - 메시지의 지속성과 순서 보장을 제공하므로, 데이터 무손실 및 정확한 순서로 처리해야 하는 경우에 유용합니다.
  - 다양한 언어 및 프레임워크에서 지원되는 개방형 플랫폼입니다.
- 단점:
  - 운영 및 관리에 대한 복잡성이 있으며, 클러스터 구성과 관리에 대한 추가 작업이 필요합니다.
  - Kafka는 대규모 데이터 처리에 최적화되어 있어서, 작은 규모의 애플리케이션에는 과도한 복잡성일 수 있습니다.
  - 자체적으로는 메시지 지각(latency)이 낮으나, 데이터의 유지 및 복제를 위한 추가 작업은 지연을 발생시킬 수 있습니다.



메세징 시스템이라 어느정도 비슷한 맥락이 있어 보인다.

대용량 데이터 처리가 주요 요구 사항이고 데이터의 순서 보장과 지속성이 중요한 경우에는 Kafka가 좋아보인다.

그러나 AWS SNS + SQS는 AWS에서 관리되는 서비스로 확장성과 운영의 편의성을 제공하며, 특히 AWS 기반 아키텍처와의 통합이 간편하다는 장점이 있는듯 하다.

## 4. 어느 상황에서 사용하는것이 좋을까?

어느 상황에서 두가지의 서비스를 사용해야 하는지 알아 보았다.

AWS SNS + SQS:

- 간단한 메시징 시나리오: AWS의 관리형 서비스를 활용하여 빠르고 간편하게 메시지 큐 시스템을 구축하고자 할 때 유용하다.
- 서버리스 아키텍처: AWS Lambda와 함께 사용하여 이벤트 기반 아키텍처를 구현할 때 좋다.
- 확장성과 관리의 용이성: AWS의 관리형 서비스이기 때문에 크기 조정과 모니터링이 간편하며, 관리에 대한 부담을 줄일 수 있다.

Kafka:

- 대규모 데이터 스트리밍: 초당 수백만 개의 이벤트를 처리해야 하는 대규모 데이터 스트리밍 시나리오에서 Kafka는 매우 효과적이다.
- 실시간 데이터 파이프라인: 다양한 데이터 소스와 대량의 데이터를 실시간으로 수집, 처리 및 전달해야 하는 경우 Kafka는 확장성과 내결함성을 제공하며, 데이터 파이프라인을 구축하는 데 이상적이다.
- 이벤트 기반 아키텍처: 이벤트 주도 아키텍처를 적용하고자 할 때 Kafka는 이벤트를 안정적으로 스트리밍하고 다양한 컨슈머가 처리할 수 있도록 지원한다.

개요와 3번에서 설명한 내용과 비슷하다.

특히 간단한 시나리오와 확장성 그리도 💵에 있어 선택을 하지 않을 수 없었다.



## 5. 정리

서비스 선택은 어플리케이션의 요구 사항, 규모, 성능, 기능 등에 따라 달라진다. 

따라서 특정 어플리케이션에 대해 가장 적합한 서비스를 선택하려면 해당 어플리케이션의 요구 사항과 목표를 고려해야 한다.

AWS SNS + SQS는 AWS에서 제공하는 간편하고 확장성이 뛰어난 서비스다. Kafka는 대용량 실시간 데이터 처리 및 메시지 순서 보장에 특화되어 있다.

간단하게 구현과 돈은 어쩔수 없다보다.

선택지는 이것밖에 없었고 다음을 노려볼수밖에...🥲 
